---
import BaseLayout from "@layouts/BaseLayout.astro";
import { getEntry } from 'astro:content';
import { Image } from 'astro:assets';
import Switch2 from '@img/games/switch2.svg';
import Switch from '@img/games/switch.svg';
import Wii from '@img/games/wii.svg';
import GC from '@img/games/gc.svg';
import N3DS from '@img/games/3ds.svg';
import DS from '@img/games/ds.svg';
import GBA from '@img/games/gba.svg';
import PS5 from '@img/games/ps5.svg';
import PS4 from '@img/games/ps4.svg';
import PS3 from '@img/games/ps3.svg';
import PS2 from '@img/games/ps2.svg';
import PS1 from '@img/games/psx.svg';
import XB from '@img/games/xbox.svg';
import Steam from '@img/games/steam.svg';

const gamesEntry = await getEntry('games', 'games');
const gamesByPlatform = gamesEntry?.data.games;

type GameEntry = {
  moby: number;
  title: string;
  image?: ImageMetadata;
};

const platformIcons: Record<string, { component: any; class?: string }> = {
  'PlayStation 5': { component: PS5 },
  'PlayStation 4': { component: PS4 },
  'PlayStation 3': { component: PS3 },
  'PlayStation 2': { component: PS2 },
  'PlayStation': { component: PS1 },
  'Nintendo Switch 2': { component: Switch2, class: 'switch2-icon' },
  'Nintendo Switch': { component: Switch },
  'Wii': { component: Wii, class: 'wii-icon' },
  'GameCube': { component: GC },
  'Nintendo 3DS': { component: N3DS },
  'Nintendo DS': { component: DS },
  'GameBoy Advance': { component: GBA },
  'XBox 360': { component: XB },
  'Steam': { component: Steam },
};

const title = "Games";
const desc = "List of all video games I own by platform.";
---
<BaseLayout title={title} description={desc}>
<section>
  <h1>{title}</h1>
  <hr />
  <p>{desc}</p>
  {gamesByPlatform && Object.entries(gamesByPlatform).map(([platform, games]) => {
    const typedGames = games as GameEntry[];
    const icon = platformIcons[platform];
    const IconComponent = icon?.component;
    return (
      <details>
        <summary>
          {IconComponent ? (
            <IconComponent 
              class={`platform-icon ${icon.class || ''}`}
            />
          ) : (
            <span>{platform}</span>
          )}
          <span class="count">{typedGames.length}</span>
        </summary>
        {platform === 'Steam' && <p class="platform-note">This is only games <b>I've actually played</b> since I have many games on Steam I've never even installed...</p>}
        <ul>
          {typedGames.map(game => (
            <li>
              <span>{game.title}</span>
            </li>
          ))}
        </ul>
      </details>
    );
  })}
</section>

<style>
  section {
    margin-bottom: 2em;
  }

  details {
    margin-bottom: 0.5em;
    padding: 0;
  }
  
  summary {
    cursor: pointer;
    font-weight: bold;
    padding: 0.25em;
    display: flex;
    align-items: center;
    gap: 0.5em;
    color: var(--primary);
    display: list-item;
    list-style-position: inside;
  }

  summary > * {
    display: inline-flex;
    vertical-align: middle;
  }

  summary svg {
    filter: var(--game-platform);
  }

  .platform-icon {
    width: 100px;
    height: auto;
    margin: 0;
    padding: 0;
  }
  
  .count {
    display: inline-flex;
    justify-content: center;
    place-items: center;
    min-width: 22px;
    height: 22px;
    padding: 0 1px 0 0;
    margin-left: 0.25em;
    background: var(--border);
    border-radius: 9999px;
    font-family: var(--sub-font);
    font-size: 0.5em;
  }
  
  .platform-note {
    padding: 4px 8px;
    background-color: var(--dropdown);
    border-left: 1px solid var(--primary);
    margin: 0.5em 0 0.5em 0.85em;
    font-family: var(--sub-font);
    font-style: italic;
    font-size: 0.75em;
  }
  
  ul {
    padding: 0 0 0 1em;
    margin: 0 0 1em 0;
  }
  
  li {
    display: flex;
    align-items: center;
    gap: 0;
    margin: 0;
    padding: 0 0 0 0.25em;
  }

  .switch2-icon {
    width: 36px;
    height: auto;
  }

  .wii-icon {
    width: 36px;
    height: auto;
  }
</style>
