---
import type { CollectionEntry } from "astro:content";
import BaseLayout from "@layouts/BaseLayout.astro";
import FormattedDate from "@components/FormattedDate.astro";
import ScrollProgress from "@components/ScrollProgress.astro";

type Props = CollectionEntry<"wiki">["data"];

const { title, description, tag, pubDate, updatedDate } = Astro.props;
---

<BaseLayout title={title} description={description}>

  <link slot="head" rel="stylesheet" href="/prism.css" />

  <style>
    h1 {
      margin: 1.1em 0 0 0;
      font-weight: 800;
    }
    hr {
      margin-top: 1em;
    }
    article {
      margin-top: 2em;
    }
    .date {
      font-size: 0.875em;
      margin-top: 0.5em;
      display: grid;
      grid-template-columns: 3;
      grid-template-rows: 2;
    }
    .last-updated-on {
      display: inline-flex;
      place-items: center;
      color: var(--emphasis);
    }
    .tag {
      margin: -0.2em auto 0.3em auto;
    }
    .tag span {
      font-family: var(--sub-font);
      background-color: var(--info);
      color: #000;
      border: 0;
      border-radius: 0.25em;
      padding: 4px 8px;
      font-weight: 600;
      font-size: 0.75em;
    }
    .bottom-line {
      margin: 2em auto 1.5em auto;
    }
    .wiki-aside {
      display: inline-flex;
      justify-content: space-between;
      font-size: 1.5em;
      margin: 0 auto 1em auto;
      padding: 0 auto;
      width: 100%;
    }
    @media screen and (max-width: 667px) {
      .tag {
        margin: 0.5em auto;
      }
    }
  </style>

  <ScrollProgress />
  <article>
    <h1 class="title">{title}</h1>
    <p class="tag">
      <span>{tag}</span>
    </p>
    <div class="date">
      <FormattedDate date={pubDate} />
      {
        updatedDate && (
          <div class="last-updated-on">
            Updated&nbsp;<FormattedDate date={updatedDate} />
          </div>
        )
      }
    </div>
    <hr />
    <p>
      {description}
    </p>
    <slot>
      <p>
        If you're seeing this, something went wrong! Please try <em
          >reloading the page</em
        >.
      </p>
    </slot>
  </article>
  <hr class="bottom-line" />

  <aside class="wiki-aside">
    <a href="/wiki/" rel="prefetch-intent" class="top blog-tag"><button>↩ Wiki</button></a>
    <a href="/" rel="prefetch-intent" class="top blog-tag home"><button>↰ Home</button></a>
    <a href="#top" class="top blog-tag"><button>Top ↑</button></a>
  </aside>

  <script is:inline>
    document.querySelectorAll('blockquote').forEach((blockquote) => {
      const firstPara = blockquote.querySelector('p');
      if (firstPara) {
        const text = firstPara.textContent || '';
        const match = text.match(/^\[(\w+)\]\s*/);
        
        if (match) {
          const type = match[1];
          blockquote.setAttribute('data-type', type);
          blockquote.classList.add(`blockquote-${type}`);
          
          const textNode = firstPara.firstChild;
          if (textNode && textNode.nodeType === Node.TEXT_NODE && textNode.textContent) {
            textNode.textContent = textNode.textContent.replace(/^\[(\w+)\]\s*/, '');
          }
        }
      }
    });
  </script>
</BaseLayout>
