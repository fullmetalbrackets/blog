---
import BaseLayout from "@layouts/BaseLayout.astro";
import BackToTop from "@components/BackToTop.astro";

const { frontmatter } = Astro.props;
const showTop = frontmatter.showTop !== false;
---

<BaseLayout title={frontmatter.title} description={frontmatter.description}>

  <link slot="head" rel="stylesheet" href="/prism.css" />

  <style scoped>
    h1 {
      font-family: var(--sub-font);
      font-weight: 900;
      margin: 1.175em 0 0 0;
      line-height: 1.1;
    }
    hr {
      margin-top: 0.75em;
    }
    article {
      margin-top: 2em;
    }
    .bottom-line {
      margin: 2em auto 1.5em auto;
    }
    .years {
      margin: 1em auto;
    }
  </style>

  <article>
    <h1>{frontmatter.title}</h1>
    <hr />
    <slot>
      <p>
        If you're seeing this, something went wrong! Please try <em
          >reloading the page</em
        >.
      </p>
    </slot>
  </article>
    {showTop && 
      <hr class="bottom-line" />
      <BackToTop />
    }
  <script is:inline>
    document.querySelectorAll('blockquote').forEach((blockquote) => {
      const firstPara = blockquote.querySelector('p');
      if (firstPara) {
        const text = firstPara.textContent || '';
        const match = text.match(/^\[(\w+)\]\s*/);
        
        if (match) {
          const type = match[1];
          blockquote.setAttribute('data-type', type);
          blockquote.classList.add(`blockquote-${type}`);
          
          const textNode = firstPara.firstChild;
          if (textNode && textNode.nodeType === Node.TEXT_NODE && textNode.textContent) {
            textNode.textContent = textNode.textContent.replace(/^\[(\w+)\]\s*/, '');
          }
        }
      }
    });

    const article = document.querySelector('article');
    if (article) {
      const hr = article.querySelector('hr');
      const description = article.querySelector('.description');
      
      if (hr && description) {
        let tocElement = description.nextElementSibling;

        if (tocElement) {
          const firstContentElement = tocElement.nextElementSibling;

          if (firstContentElement && 
              firstContentElement.tagName === 'BLOCKQUOTE' &&
              firstContentElement.getAttribute('data-type') === 'warning') {
            hr.parentNode.insertBefore(firstContentElement, hr.nextSibling);
          }
        }
      }
    }
  </script>
</BaseLayout>
